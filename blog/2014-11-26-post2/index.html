<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Carmen La</title>
  <link rel="shortcut icon" type="image/png" href="/blog/img/favicon.png">
  <meta name="description" content="I work at UHN Digital developing clinical applications with Clojure and ClojureScript." />
  <meta name="keywords" content="Carmen La, developer, clojure, Toronto" />
  <meta name="author" content="Carme La" />
  
   
  <meta name="canonical" content="http://carmenla.me/blog/2014-11-26-post2/">
  
  <meta property="og:title" content="Carmen La">
  <meta property="og:description" content="I work at UHN developing clinical applications with Clojure and ClojureScript.">
  <meta property="og:url" content="http://carmen.la">
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:site_name" content="Carmen La">
  <link href="https://fonts.googleapis.com/css?family=Merriweather|Inconsolata|Roboto:400,700" rel="stylesheet">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/github.min.css">
  <link href="/blog/css/base.css" rel="stylesheet" type="text/css" />
  <link href="/blog/css/blog.css" rel="stylesheet" type="text/css" />

</head>

<body>
  <div class="container">
    <main>
      <section id="nav">
        <div>
          <a href="/blog/archives/">Archives</a>
          <a href="/blog/tags/">Tags</a>
          <a href="/blog/rss.xml">RSS</a>
        </div>
        <a class="blog-name" href="http://carmen.la">// <span>Carmen La</span></a>
      </section>
      <section id="content">
        
<div id="post">
  November 26, 2014
<h1>Updates and Architecture</h1>
<div id="post-content">
   <p>It's been about two weeks since I released Cryogen to the public and the feedback has been great so I'd like to go over some of the changes that have been made thus far and a how everything fits together behind Cryogen.</p><p><!&ndash;more&ndash;></p><h2 id="updates">Updates</h2><p>Someone pointed out to me that posts or pages that were deleted from <code>resources/templates</code> would have to be manually deleted from <code>resources/public</code> in order for the sitemap and RSS feed to be updated correctly since these two files are generated based on the contents of the <code>public</code> folder.</p><p>To remedy this, I updated the compiler to wipe out the <code>public</code> folder and then generate all of its contents again with each compile. I was actually worried that this would increase compile time but <a href='http://yogthos.net/'>Yogthos's blog</a> has actually moved to Cryogen and found no problems with performance even with his 60+ existing posts.</p><p>Previously, any asset folders like css and javascript were stored under <code>public</code> but then have now been moved to <code>templates</code>. <em>Everything</em> in the public folder is now generated by the compiler. I've added the <code>:resources</code> key to the config that lets you specify which asset folders you would like to copy over from <code>templates</code> to <code>public</code>.</p><pre><code class="clojure">:resources &#91;&quot;css&quot; &quot;js&quot; &quot;img&quot;&#93;
</code></pre><p>The copying is done by this simple function in <code>src/cryogen/io.clj</code> using <a href='https://github.com/Raynes/fs'>fs</a>.</p><pre><code class="clojure">&#40;defn copy-resources &#91;{:keys &#91;blog-prefix resources&#93;}&#93;
  &#40;doseq &#91;resource resources&#93;
    &#40;fs/copy-dir
      &#40;str &quot;resources/templates/&quot; resource&#41;
      &#40;str public blog-prefix &quot;/&quot; resource&#41;&#41;&#41;&#41;
</code></pre><p>Cryogen also has <a href='https://disqus.com/'>Disqus</a> support now. Simply register your blog on Disqus, add your <code>disqus-shortname</code> to the config and set <code>disqus?</code> to <code>true</code> and Selmer will inject the info into the following script in the post template.</p><pre><code>{% if disqus-shortname %}
&lt;div id=&quot;disqus&#95;thread&quot;&gt;&lt;/div&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
    &#40;function&#40;&#41; {
        var dsq = document.createElement&#40;'script'&#41;; dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//{{disqus-shortname}}.disqus.com/embed.js';
        &#40;document.getElementsByTagName&#40;'head'&#41;&#91;0&#93; || document.getElementsByTagName&#40;'body'&#41;&#91;0&#93;&#41;.appendChild&#40;dsq&#41;;
    }&#41;&#40;&#41;;
&lt;/script&gt;
{% endif %}
</code></pre><p>For long posts or pages with numerous headings, you can now generate a table of contents. Just add <code>:toc true</code> to the metadata of the post or page where you want to generate a toc. For example:</p><pre><code class="clojure">{:title &quot;Updates and Architecture&quot;
 :layout :post
 :tags &#91;:cryogen :clojure&#93;
 :toc true}
</code></pre><p>Some other updates:</p><ul><li>Can now customize the number of recent posts shown<ul><li>Sass support by <a href='https://github.com/turbopape'>turbopape</a></li><li>Archive sorting fixed for users with a locale that isn't "en"</li></ul></li></ul><h2 id="architecture">Architecture</h2><p>Sometimes things are obvious to you when you design them but not necessarily to others. I've received a few questions regarding templating on the Cryogen repo so I thought I'd go over the basic architecture here.</p><p>The reason I created Cryogen was because I wanted a site generator (in Clojure!) that had a clear separation between content and layout. The idea is that you create HTML templates under <code>resources/templates/html/layouts</code> with whatever layout/theme you want and the content of your posts and pages from <code>resources/templates/md</code> gets injected by the compiler through Selmer.</p><p><strong> Post/Page Layouts </strong></p><p>Each markdown file representing a post or page must contain metadata about the layout in the <code>:layout</code> key that corresponds to an HTML file under <code>html/layouts</code>. For example, this post's metadata is as follows:</p><pre><code class="clojure">{:title &quot;Updates and Architecture&quot;
 :layout :post
 :tags &#91;:cryogen :clojure&#93;}
</code></pre><p>When the site gets built, this is what puts the post together:</p><pre><code class="clojure">&#40;spit &#40;str public &#40;:uri post&#41;&#41;
            &#40;render-file &#40;str &quot;templates/html/layouts/&quot; &#40;:layout post&#41;&#41;
                         &#40;merge default-params
                                {:servlet-context  &quot;../&quot;
                                 :post             post
                                 :disqus-shortname disqus-shortname}&#41;&#41;&#41;
</code></pre><p>Selmer will render the post and the compiler will spit it out into the <code>public</code> folder.</p><p>The second argument passed into <code>render-file</code> is a map of items that Selmer will inject into the specified layout. In this case, that will be <code>post.html</code>.</p><pre><code class="django">&lt;div id=&quot;post&quot;&gt;
    ...
    &lt;h2&gt;{{post.title}}&lt;/h2&gt;
    ...
    &lt;div&gt;
        {{post.content|safe}}
    &lt;/div&gt;
    ...
&lt;/div&gt;
</code></pre><p>Here, <code>post</code> is another map of items so <code>{{post.title}}</code> and <code>{{post.content}}</code> will render the values of <code>:title</code> and <code>:content</code> from <code>post</code>. Pages and tags are compiled in a similar fashion.</p><p><strong> Templates </strong></p><p>This segues into how inheritance works in the templates. In the <code>layouts</code> folder, <code>base.html</code> contains the header, sidebar and footer of the site. These are the things that remain constant no matter what page or post you are viewing. The page/post content gets injected into the main reading pane with <code>{% block content %}</code>:</p><pre><code>&lt;body&gt;
    &lt;!--header--&gt;
    &lt;!--sidebar--&gt;
    ...
    &lt;div id=&quot;content&quot;&gt;
    {% block content %}
    {% endblock %}
    &lt;/div&gt;
    ...
    &lt;!--footer--&gt;
&lt;/body&gt;
</code></pre><p>To inherit the base template, all the other html files in the <code>layouts</code> folder start with a line of code that specifies the path of the base layout it should inherit followed by the layout for that page or post wrapped in <code>{% block content %}</code>.</p><p>A short example is the layout for pages.</p><pre><code>{% extends &quot;templates/html/layouts/base.html&quot; %}
{% block content %}
&lt;div id=&quot;custom-page&quot;&gt;
    &lt;div id=&quot;page-header&quot;&gt;
        &lt;h2&gt;{{page.title}}&lt;/h2&gt;
    &lt;/div&gt;
    {% if page.toc %}{{page.toc|safe}}{% endif %}
    {{page.content|safe}}
&lt;/div&gt;
{% endblock %}
</code></pre><p>And that's it! If you want to change the header, sidebar or footer - change it in <code>base.html</code>. If you want to add more post or page layouts, create a new html file under <code>resources/templates/html/layouts</code> and follow the above structure. If you want to add different filters to your content, please check out the <a href='https://github.com/yogthos/selmer#usage'>Selmer docs</a>.</p>
</div>
  
    <b>Tags: </b> 
    <a href="/blog/tag/cryogen/">cryogen</a> 
    <a href="/blog/tag/clojure/">clojure</a> 
  

  <div id="prev-next">
    
    <a href="/blog/2014-12-08-post3/">&laquo; Previous Post</a>
    
    
    <a href="/blog/2014-11-12-post1/">Next Post &raquo;</a>
    
  </div>

  
</div>

      </section>
      <section id="footer">
        <p>&copy; <span id="cpyear"></span> Carmen La</p>
        <p>Powered by <a href="http://cryogenweb.org">Cryogen</a></p>
        <p><a href="#" name="top" title="Back to top">Back to top â†‘</a></p>
      </section>
    </main>
  </div>

  <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
  <script src="/blog/js/main.js" type="text/javascript"></script>
  <script src="/blog/js/highlight.pack.js" type="text/javascript"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-56703143-1', 'auto');
    ga('send', 'pageview');
  </script>
</body>

</html>
